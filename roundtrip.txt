Running tests/OverlayDraw.frag ...
Token(kind='OP', value='.', pos=867)
Token(kind='OP', value='/', pos=870)
Token(kind=';', value=';', pos=886)
Token(kind=';', value=';', pos=886)
Token(kind='OP', value='/', pos=925)
Token(kind=';', value=';', pos=928)
Token(kind=';', value=';', pos=928)
Token(kind='[', value='[', pos=973)
Token(kind=']', value=']', pos=985)
Token(kind='OP', value='.', pos=986)
Token(kind='[', value='[', pos=991)
Token(kind='OP', value='/', pos=1002)
Token(kind=']', value=']', pos=1005)
Token(kind=']', value=']', pos=1005)
Token(kind=';', value=';', pos=1006)
Token(kind='OP', value='%', pos=1039)
Token(kind=';', value=';', pos=1042)
Token(kind=';', value=';', pos=1042)
Token(kind='OP', value='==', pos=1156)
Token(kind=')', value=')', pos=1160)
Token(kind=')', value=')', pos=1160)
Token(kind='OP', value='=', pos=1188)
Token(kind='[', value='[', pos=1199)
Token(kind=']', value=']', pos=1201)
Token(kind=';', value=';', pos=1202)
Token(kind=';', value=';', pos=1202)
Token(kind='OP', value='==', pos=1227)
Token(kind=')', value=')', pos=1231)
Token(kind=')', value=')', pos=1231)
Token(kind='OP', value='=', pos=1259)
Token(kind='[', value='[', pos=1270)
Token(kind=']', value=']', pos=1272)
Token(kind=';', value=';', pos=1273)
Token(kind=';', value=';', pos=1273)
Token(kind='OP', value='==', pos=1298)
Token(kind=')', value=')', pos=1302)
Token(kind=')', value=')', pos=1302)
Token(kind='OP', value='=', pos=1330)
Token(kind='[', value='[', pos=1341)
Token(kind=']', value=']', pos=1343)
Token(kind=';', value=';', pos=1344)
Token(kind=';', value=';', pos=1344)
Token(kind='OP', value='=', pos=1387)
Token(kind='[', value='[', pos=1398)
Token(kind=']', value=']', pos=1400)
Token(kind=';', value=';', pos=1401)
Token(kind=';', value=';', pos=1401)
Token(kind='OP', value='%', pos=1444)
Token(kind=')', value=')', pos=1447)
Token(kind=')', value=')', pos=1447)
Token(kind='OP', value='*', pos=1449)
Token(kind=';', value=';', pos=1452)
Token(kind=';', value=';', pos=1452)
Token(kind='OP', value='>>', pos=1479)
Token(kind='OP', value='-', pos=1486)
Token(kind=')', value=')', pos=1493)
Token(kind=')', value=')', pos=1493)
Token(kind=')', value=')', pos=1494)
Token(kind=')', value=')', pos=1494)
Token(kind='OP', value='&', pos=1496)
Token(kind=';', value=';', pos=1502)
Token(kind=';', value=';', pos=1502)
Token(kind='OP', value='%', pos=1717)
Token(kind=';', value=';', pos=1732)
Token(kind=';', value=';', pos=1732)
Token(kind='(', value='(', pos=1755)
Token(kind=',', value=',', pos=1760)
Token(kind='(', value='(', pos=1767)
Token(kind=',', value=',', pos=1780)
Token(kind=')', value=')', pos=1790)
Token(kind=')', value=')', pos=1790)
Token(kind=',', value=',', pos=1791)
Token(kind=',', value=',', pos=1791)
Token(kind='(', value='(', pos=1796)
Token(kind=')', value=')', pos=1804)
Token(kind=')', value=')', pos=1805)
Token(kind=')', value=')', pos=1805)
Token(kind='OP', value='.', pos=1806)
Token(kind=';', value=';', pos=1808)
Token(kind='[', value='[', pos=1900)
Token(kind=']', value=']', pos=1912)
Token(kind='OP', value='.', pos=1913)
Token(kind=';', value=';', pos=1922)
Token(kind='OP', value='.', pos=1970)
Token(kind=';', value=';', pos=1973)
Token(kind='OP', value='.', pos=2014)
Token(kind=';', value=';', pos=2016)
Token(kind='(', value='(', pos=2107)
Token(kind=',', value=',', pos=2121)
Token(kind='OP', value='.', pos=2136)
Token(kind=')', value=')', pos=2138)
Token(kind=')', value=')', pos=2138)
Token(kind=';', value=';', pos=2139)
Token(kind='OP', value='>=', pos=2282)
Token(kind=')', value=')', pos=2300)
Token(kind=')', value=')', pos=2300)
Token(kind='(', value='(', pos=2327)
Token(kind=')', value=')', pos=2329)
Token(kind=';', value=';', pos=2330)
Token(kind='(', value='(', pos=2427)
Token(kind=',', value=',', pos=2436)
Token(kind=',', value=',', pos=2451)
Token(kind=',', value=',', pos=2451)
Token(kind=',', value=',', pos=2466)
Token(kind=',', value=',', pos=2466)
Token(kind=')', value=')', pos=2475)
Token(kind=')', value=')', pos=2475)
Token(kind=';', value=';', pos=2476)
Token(kind='(', value='(', pos=2501)
Token(kind=',', value=',', pos=2503)
Token(kind=',', value=',', pos=2506)
Token(kind=',', value=',', pos=2506)
Token(kind=',', value=',', pos=2509)
Token(kind=',', value=',', pos=2509)
Token(kind=')', value=')', pos=2514)
Token(kind=')', value=')', pos=2514)
Token(kind=';', value=';', pos=2515)
Token(kind='OP', value='=', pos=2528)
Token(kind='(', value='(', pos=2533)
Token(kind=',', value=',', pos=2540)
Token(kind='[', value='[', pos=2557)
Token(kind=']', value=']', pos=2569)
Token(kind='OP', value='.', pos=2570)
Token(kind=',', value=',', pos=2576)
Token(kind=',', value=',', pos=2576)
Token(kind=')', value=')', pos=2589)
Token(kind=')', value=')', pos=2589)
Token(kind=';', value=';', pos=2590)
Token(kind=';', value=';', pos=2590)
Token(kind=';', value=';', pos=2610)
Token(kind='OP', value='.', pos=2722)
Token(kind='OP', value='/', pos=2725)
Token(kind='OP', value='.', pos=2737)
Token(kind=';', value=';', pos=2739)
Token(kind=';', value=';', pos=2739)
Token(kind='[', value='[', pos=2785)
Token(kind=']', value=']', pos=2797)
Token(kind='OP', value='.', pos=2798)
Token(kind='[', value='[', pos=2805)
Token(kind='OP', value='/', pos=2817)
Token(kind=']', value=']', pos=2820)
Token(kind=']', value=']', pos=2820)
Token(kind=';', value=';', pos=2821)
Token(kind='OP', value='%', pos=2855)
Token(kind=';', value=';', pos=2858)
Token(kind=';', value=';', pos=2858)
Token(kind='OP', value='==', pos=2950)
Token(kind=')', value=')', pos=2954)
Token(kind=')', value=')', pos=2954)
Token(kind='[', value='[', pos=2986)
Token(kind=']', value=']', pos=2988)
Token(kind=';', value=';', pos=2989)
Token(kind='OP', value='==', pos=3014)
Token(kind=')', value=')', pos=3018)
Token(kind=')', value=')', pos=3018)
Token(kind='[', value='[', pos=3050)
Token(kind=']', value=']', pos=3052)
Token(kind=';', value=';', pos=3053)
Token(kind='OP', value='==', pos=3078)
Token(kind=')', value=')', pos=3082)
Token(kind=')', value=')', pos=3082)
Token(kind='[', value='[', pos=3114)
Token(kind=']', value=']', pos=3116)
Token(kind=';', value=';', pos=3117)
Token(kind='[', value='[', pos=3164)
Token(kind=']', value=']', pos=3166)
Token(kind=';', value=';', pos=3167)
Token(kind='[', value='[', pos=3265)
Token(kind=']', value=']', pos=3277)
Token(kind='OP', value='.', pos=3278)
Token(kind=';', value=';', pos=3290)
Token(kind='OP', value='.', pos=3375)
Token(kind='OP', value='==', pos=3378)
Token(kind='OP', value='||', pos=3383)
Token(kind='OP', value='||', pos=3383)
Token(kind='OP', value='.', pos=3399)
Token(kind='OP', value='==', pos=3402)
Token(kind='OP', value='||', pos=3407)
Token(kind='OP', value='||', pos=3407)
Token(kind='OP', value='||', pos=3407)
Token(kind='OP', value='.', pos=3431)
Token(kind='OP', value='+', pos=3434)
Token(kind='OP', value='==', pos=3438)
Token(kind='OP', value='==', pos=3438)
Token(kind='OP', value='.', pos=3454)
Token(kind='OP', value='-', pos=3457)
Token(kind='OP', value='.', pos=3471)
Token(kind=')', value=')', pos=3473)
Token(kind=')', value=')', pos=3473)
Token(kind='OP', value='||', pos=3475)
Token(kind='OP', value='||', pos=3475)
Token(kind='OP', value='||', pos=3475)
Token(kind='OP', value='.', pos=3499)
Token(kind='OP', value='+', pos=3502)
Token(kind='OP', value='==', pos=3506)
Token(kind='OP', value='==', pos=3506)
Token(kind='OP', value='.', pos=3522)
Token(kind='OP', value='-', pos=3525)
Token(kind='OP', value='.', pos=3539)
Token(kind=')', value=')', pos=3541)
Token(kind=')', value=')', pos=3541)
Token(kind=')', value=')', pos=3542)
Token(kind=')', value=')', pos=3542)
Token(kind=')', value=')', pos=3542)
Token(kind='(', value='(', pos=3569)
Token(kind=',', value=',', pos=3571)
Token(kind=',', value=',', pos=3574)
Token(kind=',', value=',', pos=3574)
Token(kind=',', value=',', pos=3577)
Token(kind=',', value=',', pos=3577)
Token(kind=')', value=')', pos=3580)
Token(kind=')', value=')', pos=3580)
Token(kind=';', value=';', pos=3581)
Token(kind='[', value='[', pos=3634)
Token(kind=']', value=']', pos=3646)
Token(kind='OP', value='.', pos=3647)
Token(kind='OP', value='.', pos=3658)
Token(kind=';', value=';', pos=3660)
Token(kind='(', value='(', pos=3745)
Token(kind=',', value=',', pos=3759)
Token(kind=')', value=')', pos=3771)
Token(kind=')', value=')', pos=3771)
Token(kind=';', value=';', pos=3772)
Token(kind='OP', value='.', pos=3817)
Token(kind='OP', value='-', pos=3820)
Token(kind='OP', value='.', pos=3834)
Token(kind=';', value=';', pos=3836)
Token(kind=';', value=';', pos=3836)
Token(kind='OP', value='>', pos=4027)
Token(kind='OP', value='&&', pos=4042)
Token(kind='OP', value='&&', pos=4042)
Token(kind='OP', value='.', pos=4058)
Token(kind='OP', value='+', pos=4061)
Token(kind='OP', value='>=', pos=4065)
Token(kind='OP', value='>=', pos=4065)
Token(kind='OP', value='&&', pos=4093)
Token(kind='OP', value='&&', pos=4093)
Token(kind='OP', value='&&', pos=4093)
Token(kind='OP', value='.', pos=4111)
Token(kind='OP', value='^', pos=4114)
Token(kind='OP', value='.', pos=4129)
Token(kind=')', value=')', pos=4131)
Token(kind=')', value=')', pos=4131)
Token(kind='OP', value='&', pos=4133)
Token(kind=')', value=')', pos=4136)
Token(kind=')', value=')', pos=4136)
Token(kind='OP', value='==', pos=4138)
Token(kind=';', value=';', pos=4142)
Token(kind=';', value=';', pos=4142)
Token(kind=';', value=';', pos=4142)
Token(kind='OP', value='-', pos=4167)
Token(kind='OP', value='.', pos=4182)
Token(kind=')', value=')', pos=4184)
Token(kind=')', value=')', pos=4184)
Token(kind='OP', value='>=', pos=4186)
Token(kind='OP', value='||', pos=4195)
Token(kind='OP', value='||', pos=4195)
Token(kind=')', value=')', pos=4214)
Token(kind=')', value=')', pos=4214)
Token(kind='(', value='(', pos=4241)
Token(kind=')', value=')', pos=4243)
Token(kind=';', value=';', pos=4244)
Token(kind='[', value='[', pos=4280)
Token(kind=']', value=']', pos=4292)
Token(kind='OP', value='.', pos=4293)
Token(kind=';', value=';', pos=4299)
Token(kind='OP', value='.', pos=4355)
Token(kind='OP', value='?', pos=4371)
Token(kind='[', value='[', pos=4388)
Token(kind=']', value=']', pos=4400)
Token(kind='OP', value='.', pos=4401)
Token(kind='OP', value=':', pos=4422)
Token(kind='[', value='[', pos=4440)
Token(kind=']', value=']', pos=4452)
Token(kind='OP', value='.', pos=4453)
Token(kind=';', value=';', pos=4465)
Token(kind=';', value=';', pos=4465)
Token(kind='(', value='(', pos=4495)
Token(kind='(', value='(', pos=4501)
Token(kind='OP', value='.', pos=4514)
Token(kind=')', value=')', pos=4517)
Token(kind=')', value=')', pos=4518)
Token(kind=';', value=';', pos=4519)
Token(kind='OP', value='.', pos=4536)
Token(kind=')', value=')', pos=4545)
Token(kind='OP', value='.', pos=4627)
Token(kind='OP', value='=', pos=4630)
Token(kind='OP', value='.', pos=4638)
Token(kind='OP', value='.', pos=4651)
Token(kind='OP', value='-', pos=4654)
Token(kind='OP', value='-', pos=4658)
Token(kind='OP', value='-', pos=4658)
Token(kind='OP', value='.', pos=4670)
Token(kind=';', value=';', pos=4672)
Token(kind=';', value=';', pos=4672)
Token(kind=';', value=';', pos=4672)
Token(kind='OP', value='=', pos=4693)
Token(kind='OP', value='.', pos=4705)
Token(kind=';', value=';', pos=4708)
Token(kind=';', value=';', pos=4708)
Token(kind='OP', value='-', pos=4807)
Token(kind='OP', value='.', pos=4821)
Token(kind=';', value=';', pos=4824)
Token(kind=';', value=';', pos=4824)
Token(kind='(', value='(', pos=4888)
Token(kind='(', value='(', pos=4897)
Token(kind=',', value=',', pos=4911)
Token(kind='(', value='(', pos=4918)
Token(kind=')', value=')', pos=4920)
Token(kind=')', value=')', pos=4921)
Token(kind=')', value=')', pos=4921)
Token(kind=')', value=')', pos=4922)
Token(kind='OP', value='||', pos=4924)
Token(kind='(', value='(', pos=4938)
Token(kind='(', value='(', pos=4955)
Token(kind=',', value=',', pos=4969)
Token(kind='OP', value='.', pos=4983)
Token(kind='OP', value='-', pos=4987)
Token(kind='OP', value='.', pos=5001)
Token(kind=')', value=')', pos=5004)
Token(kind=')', value=')', pos=5004)
Token(kind=')', value=')', pos=5004)
Token(kind=')', value=')', pos=5005)
Token(kind=')', value=')', pos=5006)
Token(kind=')', value=')', pos=5006)
Token(kind='OP', value='=', pos=5028)
Token(kind='(', value='(', pos=5034)
Token(kind=',', value=',', pos=5036)
Token(kind=',', value=',', pos=5039)
Token(kind=',', value=',', pos=5039)
Token(kind=',', value=',', pos=5042)
Token(kind=',', value=',', pos=5042)
Token(kind=')', value=')', pos=5045)
Token(kind=')', value=')', pos=5045)
Token(kind=';', value=';', pos=5046)
Token(kind=';', value=';', pos=5046)
Token(kind='OP', value='.', pos=5085)
Token(kind=')', value=')', pos=5092)
Token(kind='OP', value='=', pos=5114)
Token(kind='(', value='(', pos=5126)
Token(kind=')', value=')', pos=5140)
Token(kind=';', value=';', pos=5141)
Token(kind=';', value=';', pos=5141)
Token(kind='OP', value='=', pos=5178)
Token(kind='(', value='(', pos=5191)
Token(kind=')', value=')', pos=5205)
Token(kind=';', value=';', pos=5206)
Token(kind=';', value=';', pos=5206)
uint getChar(const uvec2 coordInWidget, const uint fontGlyphWidth)
{
  const uint charIndex = (coordInWidget.x / fontGlyphWidth);
  const uint packIndex = (charIndex / 4);
  const uvec4 arrayItem = textWidgetsData[widgetIndex].text[(packIndex / 4)];
  const uint col = (packIndex % 4);
  uint packedChars;
  if ((col == 0))
  {
    (packedChars = arrayItem[0]);
  }
  else
    if ((col == 1))
    {
      (packedChars = arrayItem[1]);
    }
    else
      if ((col == 2))
      {
        (packedChars = arrayItem[2]);
      }
      else
      {
        (packedChars = arrayItem[3]);
      }
  const uint shift = ((charIndex % 4) * 8);
  return ((packedChars >> (24 - shift)) & 255);
}

float sampleFont(const uint textChar, const uvec2 coordInWidget, const uvec2 fontGlyphSize, const uint fontMip)
{
  const uvec2 coordInGlyph = (coordInWidget % fontGlyphSize);
  return texelFetch(((font , ivec3((coordInGlyph , textChar))) , int(fontMip))).x;
}

vec4 renderText(uvec2 coordInWidget)
{
  const uvec4 fontSizePacked = textWidgetsData[widgetIndex].fontSize;
  const uvec2 fontGlyphSize = fontSizePacked.xy;
  const uint fontMip = fontSizePacked.z;
  const uint textChar = getChar((coordInWidget , fontGlyphSize.x));
  if ((textChar >= FONT_CHARACTERS))
  {
    return vec4(0);
  }
  const float sampleValue = sampleFont((((textChar , coordInWidget) , fontGlyphSize) , fontMip));
  vec4 result = vec4((((0 , 0) , 0) , 0.4));
  (result = mix(((result , textWidgetsData[widgetIndex].color) , sampleValue)));
  return result;
}

uint getValue(const uvec2 coordInWidget, const uint valueWidth)
{
  const uint valueIndex = (coordInWidget.x / valueWidth.x);
  const uvec4 arrayItem = graphWidgetsData[widgetIndex].values[(valueIndex / 4)];
  const uint col = (valueIndex % 4);
  if ((col == 0))
  {
    return arrayItem[0];
  }
  else
    if ((col == 1))
    {
      return arrayItem[1];
    }
    else
      if ((col == 2))
      {
        return arrayItem[2];
      }
      else
      {
        return arrayItem[3];
      }
}

vec4 renderGraph(uvec2 coordInWidget)
{
  const uvec4 widgetCoords = graphWidgetsData[widgetIndex].coordinates;
  if (((((coordInWidget.x == 0) || (coordInWidget.y == 0)) || ((coordInWidget.x + 1) == (widgetCoords.z - widgetCoords.x))) || ((coordInWidget.y + 1) == (widgetCoords.w - widgetCoords.y))))
  {
    return vec4((((0 , 0) , 0) , 1));
  }
  const uint valueWidth = graphWidgetsData[widgetIndex].valueWidth.x;
  const uint value = getValue((coordInWidget , valueWidth));
  const uint widgetHeight = (widgetCoords.w - widgetCoords.y);
  bool indicateOverflow = (((value > widgetHeight) && ((coordInWidget.y + 4) >= widgetHeight)) && (((coordInWidget.x ^ coordInWidget.y) & 1) == 0));
  if ((((widgetHeight - coordInWidget.y) >= value) || indicateOverflow))
  {
    return vec4(0);
  }
  return graphWidgetsData[widgetIndex].color;
}

void main()
{
  const uvec4 widgetCoords = (params.isText ? textWidgetsData[widgetIndex].coordinates : graphWidgetsData[widgetIndex].coordinates);
  uvec2 fragCoords = uvec2(floor(gl_FragCoord.xy));
  if (params.rotateXY)
  {
    (fragCoords.x = ((params.viewportSize.x - 1) - fragCoords.x));
    (fragCoords = fragCoords.yx);
  }
  const uvec2 coordInWidget = (fragCoords - widgetCoords.xy);
  if ((any(lessThan((coordInWidget , uvec2(0)))) || any(greaterThanEqual((coordInWidget , (widgetCoords.zw - widgetCoords.xy))))))
  {
    (color = vec4((((1 , 0) , 1) , 1)));
    return;
  }
  if (params.isText)
  {
    (color = renderText(coordInWidget));
  }
  else
  {
    (color = renderGraph(coordInWidget));
  }
}


